# ç¡¬è´Ÿæ ·æœ¬æŒ–æ˜ç­–ç•¥è¯¦è§£

## ğŸ¤” æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•åœ¨æ²¡æœ‰è®­ç»ƒå¥½çš„æ¨¡å‹æ—¶è¿›è¡Œç¡¬è´Ÿæ ·æœ¬æŒ–æ˜ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„"é¸¡ç”Ÿè›‹ï¼Œè›‹ç”Ÿé¸¡"é—®é¢˜ã€‚æˆ‘ä»¬æä¾›äº†ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼š

## ğŸ”„ ç­–ç•¥1ï¼šåˆ†é˜¶æ®µè®­ç»ƒï¼ˆæ¨èï¼‰

### æµç¨‹
```
é˜¶æ®µ1: åˆå§‹è®­ç»ƒ (33% è½®æ•°) â†’ é˜¶æ®µ2: ç¡¬è´Ÿæ ·æœ¬æŒ–æ˜ â†’ é˜¶æ®µ3: å¢å¼ºè®­ç»ƒ (67% è½®æ•°)
```

### å…·ä½“å®ç°
```python
# ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹åŸºç¡€æ¨¡å‹
initial_epochs = total_epochs * 0.33  # ä¾‹å¦‚ï¼š100 * 0.33 = 33è½®
model.train(epochs=initial_epochs)

# ç¬¬äºŒé˜¶æ®µï¼šä½¿ç”¨åŸºç¡€æ¨¡å‹è¿›è¡Œç¡¬è´Ÿæ ·æœ¬æŒ–æ˜
hard_negatives = mine_hard_negatives(model, validation_set)

# ç¬¬ä¸‰é˜¶æ®µï¼šä½¿ç”¨ç¡¬è´Ÿæ ·æœ¬è¿›è¡Œå¢å¼ºè®­ç»ƒ
remaining_epochs = total_epochs - initial_epochs  # 67è½®
model.train(epochs=remaining_epochs, focus_on_hard_negatives=True)
```

### ä¼˜åŠ¿
- âœ… æœ‰æ¨¡å‹åŸºç¡€ï¼ŒæŒ–æ˜æ›´å‡†ç¡®
- âœ… æ¸è¿›å¼æ”¹è¿›ï¼Œç¨³å®šå¯é 
- âœ… é€‚åˆå¤§å¤šæ•°åœºæ™¯

### ä½¿ç”¨ç¤ºä¾‹
```bash
python3 detection/train_yolo_with_hard_negative.py \
    --data ./datasets/l0_9.12/dataset.yaml \
    --model yolov8s.pt \
    --epochs 100 \
    --initial_epochs_ratio 0.33 \
    --mining_strategy confidence_based
```

## ğŸ¯ ç­–ç•¥2ï¼šä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹

### æµç¨‹
```
é¢„è®­ç»ƒæ¨¡å‹ â†’ ç¡¬è´Ÿæ ·æœ¬æŒ–æ˜ â†’ å¾®è°ƒè®­ç»ƒ
```

### å…·ä½“å®ç°
```python
# ä½¿ç”¨COCOé¢„è®­ç»ƒçš„YOLOæ¨¡å‹
pretrained_model = YOLO('yolov8s.pt')  # å·²ç»åœ¨COCOä¸Šè®­ç»ƒè¿‡

# åœ¨ç›®æ ‡æ•°æ®é›†ä¸Šè¿›è¡Œç¡¬è´Ÿæ ·æœ¬æŒ–æ˜
hard_negatives = mine_hard_negatives(pretrained_model, target_dataset)

# ä½¿ç”¨ç¡¬è´Ÿæ ·æœ¬è¿›è¡Œå¾®è°ƒ
model.train(data=target_dataset, focus_on_hard_negatives=True)
```

### ä¼˜åŠ¿
- âœ… æ— éœ€åˆå§‹è®­ç»ƒï¼ŒèŠ‚çœæ—¶é—´
- âœ… é¢„è®­ç»ƒæ¨¡å‹å·²æœ‰è‰¯å¥½åŸºç¡€
- âœ… é€‚åˆæœ‰é¢„è®­ç»ƒæ¨¡å‹çš„æƒ…å†µ

### ä½¿ç”¨ç¤ºä¾‹
```bash
python3 detection/train_yolo_with_hard_negative.py \
    --data ./datasets/l0_9.12/dataset.yaml \
    --model yolov8s.pt \
    --epochs 100 \
    --use_pretrained_for_mining \
    --mining_strategy confidence_based
```

## ğŸ”„ ç­–ç•¥3ï¼šåœ¨çº¿ç¡¬è´Ÿæ ·æœ¬æŒ–æ˜

### æµç¨‹
```
è®­ç»ƒ1è½® â†’ æŒ–æ˜ç¡¬è´Ÿæ ·æœ¬ â†’ è°ƒæ•´è®­ç»ƒæ•°æ® â†’ è®­ç»ƒ1è½® â†’ ...
```

### å…·ä½“å®ç°
```python
for epoch in range(total_epochs):
    # æ­£å¸¸è®­ç»ƒä¸€ä¸ªepoch
    model.train_one_epoch(training_data)
    
    # æ¯10ä¸ªepochè¿›è¡Œä¸€æ¬¡ç¡¬è´Ÿæ ·æœ¬æŒ–æ˜
    if epoch % 10 == 0:
        hard_negatives = mine_hard_negatives(model, validation_data)
        adjust_training_data_weights(hard_negatives)
```

### ä¼˜åŠ¿
- âœ… åŠ¨æ€è°ƒæ•´ï¼Œé€‚åº”æ€§å¼º
- âœ… æŒç»­æ”¹è¿›ï¼Œæ•ˆæœæœ€ä½³
- âœ… é€‚åˆé•¿æœŸè®­ç»ƒ

### åŠ£åŠ¿
- âŒ è®¡ç®—å¼€é”€å¤§
- âŒ å®ç°å¤æ‚
- âŒ éœ€è¦é¢‘ç¹è°ƒæ•´

## ğŸ“Š ç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | è®­ç»ƒæ—¶é—´ | å®ç°éš¾åº¦ | æ•ˆæœ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|------|----------|
| åˆ†é˜¶æ®µè®­ç»ƒ | ä¸­ç­‰ | ç®€å• | å¥½ | å¤§å¤šæ•°æƒ…å†µ |
| é¢„è®­ç»ƒæ¨¡å‹ | çŸ­ | ç®€å• | å¥½ | æœ‰é¢„è®­ç»ƒæ¨¡å‹ |
| åœ¨çº¿æŒ–æ˜ | é•¿ | å¤æ‚ | æœ€å¥½ | é•¿æœŸè®­ç»ƒé¡¹ç›® |

## ğŸ› ï¸ å‚æ•°è¯´æ˜

### æ–°å¢å‚æ•°

#### `--initial_epochs_ratio`
- **é»˜è®¤å€¼**: 0.33
- **è¯´æ˜**: åˆå§‹è®­ç»ƒé˜¶æ®µå æ€»è½®æ•°çš„æ¯”ä¾‹
- **ç¤ºä¾‹**: æ€»è½®æ•°100ï¼Œæ¯”ä¾‹0.33 â†’ åˆå§‹è®­ç»ƒ33è½®ï¼Œå¢å¼ºè®­ç»ƒ67è½®

#### `--use_pretrained_for_mining`
- **é»˜è®¤å€¼**: False
- **è¯´æ˜**: æ˜¯å¦ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œç¡¬è´Ÿæ ·æœ¬æŒ–æ˜
- **æ•ˆæœ**: è·³è¿‡åˆå§‹è®­ç»ƒé˜¶æ®µï¼Œç›´æ¥ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹æŒ–æ˜

### ä½¿ç”¨å»ºè®®

#### åœºæ™¯1ï¼šä»å¤´å¼€å§‹è®­ç»ƒ
```bash
# ä½¿ç”¨åˆ†é˜¶æ®µè®­ç»ƒ
python3 detection/train_yolo_with_hard_negative.py \
    --data ./datasets/l0_9.12/dataset.yaml \
    --model yolov8s.pt \
    --epochs 100 \
    --initial_epochs_ratio 0.4 \
    --mining_strategy confidence_based
```

#### åœºæ™¯2ï¼šæœ‰é¢„è®­ç»ƒæ¨¡å‹
```bash
# ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ç­–ç•¥
python3 detection/train_yolo_with_hard_negative.py \
    --data ./datasets/l0_9.12/dataset.yaml \
    --model yolov8s.pt \
    --epochs 100 \
    --use_pretrained_for_mining \
    --mining_strategy confidence_based
```

#### åœºæ™¯3ï¼šå¿«é€Ÿå®éªŒ
```bash
# ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œè¾ƒå°‘è½®æ•°
python3 detection/train_yolo_with_hard_negative.py \
    --data ./datasets/l0_9.12/dataset.yaml \
    --model yolov8s.pt \
    --epochs 50 \
    --use_pretrained_for_mining \
    --mining_strategy confidence_based
```

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### åˆ†é˜¶æ®µè®­ç»ƒ
- åˆå§‹é˜¶æ®µï¼šå»ºç«‹åŸºç¡€æ£€æµ‹èƒ½åŠ›
- æŒ–æ˜é˜¶æ®µï¼šè¯†åˆ«å›°éš¾æ ·æœ¬
- å¢å¼ºé˜¶æ®µï¼šé‡ç‚¹è®­ç»ƒå›°éš¾æ ·æœ¬

### é¢„è®­ç»ƒæ¨¡å‹ç­–ç•¥
- ç›´æ¥åˆ©ç”¨é¢„è®­ç»ƒçŸ¥è¯†
- å¿«é€Ÿè¯†åˆ«ç›®æ ‡åŸŸå›°éš¾æ ·æœ¬
- é«˜æ•ˆå¾®è°ƒ

## ğŸ” ç›‘æ§æŒ‡æ ‡

### è®­ç»ƒè¿‡ç¨‹ç›‘æ§
```python
# ç¡¬è´Ÿæ ·æœ¬æŒ–æ˜ç»Ÿè®¡
{
    'total_predictions': 1000,
    'hard_negatives': 150,
    'false_positives': 120,
    'false_negatives': 30,
    'hard_negative_rate': 0.15
}
```

### æ€§èƒ½æŒ‡æ ‡
```python
# æ¨¡å‹æ€§èƒ½
{
    'precision': 0.87,  # ç²¾ç¡®ç‡æå‡
    'recall': 0.96,     # å¬å›ç‡æå‡
    'f1_score': 0.91,   # F1åˆ†æ•°æå‡
    'hard_negative_rate': 0.15  # ç¡¬è´Ÿæ ·æœ¬ç‡é™ä½
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é€‰æ‹©åˆé€‚çš„ç­–ç•¥**
   - æœ‰é¢„è®­ç»ƒæ¨¡å‹ â†’ ä½¿ç”¨é¢„è®­ç»ƒç­–ç•¥
   - ä»å¤´è®­ç»ƒ â†’ ä½¿ç”¨åˆ†é˜¶æ®µç­–ç•¥
   - é•¿æœŸé¡¹ç›® â†’ è€ƒè™‘åœ¨çº¿æŒ–æ˜

2. **è°ƒæ•´å‚æ•°**
   - åˆå§‹è½®æ•°æ¯”ä¾‹ï¼š0.3-0.5
   - ç½®ä¿¡åº¦é˜ˆå€¼ï¼š0.5-0.7
   - IoUé˜ˆå€¼ï¼š0.5-0.7

3. **ç›‘æ§æ•ˆæœ**
   - è§‚å¯Ÿç¡¬è´Ÿæ ·æœ¬ç‡å˜åŒ–
   - ç›‘æ§ç²¾ç¡®ç‡å’Œå¬å›ç‡
   - åˆ†æå›°éš¾æ ·æœ¬åˆ†å¸ƒ

4. **è¿­ä»£ä¼˜åŒ–**
   - æ ¹æ®ç»“æœè°ƒæ•´å‚æ•°
   - å°è¯•ä¸åŒæŒ–æ˜ç­–ç•¥
   - ç»“åˆæ•°æ®å¢å¼ºæŠ€æœ¯

## ğŸ¯ æ€»ç»“

ç¡¬è´Ÿæ ·æœ¬æŒ–æ˜çš„æ ¸å¿ƒæ˜¯è§£å†³"å¦‚ä½•åœ¨æ²¡æœ‰å®Œç¾æ¨¡å‹æ—¶æ‰¾åˆ°å›°éš¾æ ·æœ¬"çš„é—®é¢˜ã€‚æˆ‘ä»¬æä¾›çš„ä¸‰ç§ç­–ç•¥å„æœ‰ä¼˜åŠ¿ï¼š

- **åˆ†é˜¶æ®µè®­ç»ƒ**ï¼šç¨³å®šå¯é ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯
- **é¢„è®­ç»ƒæ¨¡å‹**ï¼šå¿«é€Ÿé«˜æ•ˆï¼Œé€‚åˆæœ‰é¢„è®­ç»ƒæ¨¡å‹çš„æƒ…å†µ
- **åœ¨çº¿æŒ–æ˜**ï¼šæ•ˆæœæœ€ä½³ï¼Œé€‚åˆé•¿æœŸè®­ç»ƒé¡¹ç›®

é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼Œç»“åˆåˆç†çš„å‚æ•°è®¾ç½®ï¼Œå¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹åœ¨å›°éš¾æ ·æœ¬ä¸Šçš„è¡¨ç°ã€‚

